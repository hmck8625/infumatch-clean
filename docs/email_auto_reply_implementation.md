# ãƒ¡ãƒ¼ãƒ«è‡ªå‹•è¿”ä¿¡ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…å®Œäº†

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€Œãƒ¡ãƒ¼ãƒ«ã¸ã®è‡ªå‹•è¿”ä¿¡ãƒ¢ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—æ¨è–¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã—ã€äººé–“ã®è¨±å¯ã‚’å¾—ã¦ã‹ã‚‰è¿”ä¿¡ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã¨é¸æŠã§ãã‚‹ã‚ˆã†ã«ã—ã¦æ¬²ã—ã„ã€ã«å¯¾ã—ã¦ã€å®Œå…¨ãªãƒ¡ãƒ¼ãƒ«è‡ªå‹•è¿”ä¿¡ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

## å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### ğŸ¯ ã‚³ã‚¢æ©Ÿèƒ½

1. **AIç”Ÿæˆè¿”ä¿¡æ¡ˆä½œæˆ**
   - Gemini API + äº¤æ¸‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹é«˜å“è³ªãªè¿”ä¿¡ç”Ÿæˆ
   - ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã®ãƒãƒ£ãƒ³ãƒãƒ«ç‰¹å¾´ã‚’æ´»ç”¨ã—ãŸãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º
   - äººé–“ã‚‰ã—ã„è‡ªç„¶ãªæ–‡ç« ç”Ÿæˆ

2. **æ‰‹å‹•æ‰¿èªãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰**
   - AIç”Ÿæˆè¿”ä¿¡æ¡ˆã‚’äººé–“ãŒç¢ºèªãƒ»ç·¨é›†å¯èƒ½
   - æ‰¿èªæœŸé™è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ24æ™‚é–“ï¼‰
   - æ‰¿èªãƒ»æ‹’å¦ãƒ»æœŸé™åˆ‡ã‚Œç®¡ç†

3. **æ¡ä»¶ä»˜ãè‡ªå‹•è¿”ä¿¡ãƒ¢ãƒ¼ãƒ‰**
   - æ—¢çŸ¥ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã®ã¿è‡ªå‹•è¿”ä¿¡
   - ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡ã«ã‚ˆã‚‹åˆ¤å®š
   - æ—¥æ¬¡è‡ªå‹•è¿”ä¿¡åˆ¶é™
   - é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š

4. **ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼è‡ªå‹•ç‰¹å®š**
   - Firestore ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢
   - AIåˆ†ææ¸ˆã¿ãƒãƒ£ãƒ³ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã¨ã®é€£æº
   - å•†æãƒãƒƒãƒãƒ³ã‚°æƒ…å ±ã®æ´»ç”¨

### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **ã‚¹ãƒ‘ãƒ åˆ¤å®š**: åŸºæœ¬çš„ãªã‚¹ãƒ‘ãƒ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
- **ä¸é©åˆ‡ãƒ¡ãƒ¼ãƒ«æ¤œå‡º**: æ€ªã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **ãƒ–ãƒ©ãƒ³ãƒ‰ã‚»ãƒ¼ãƒ•ãƒ†ã‚£**: AIåˆ†æã«ã‚ˆã‚‹ãƒ–ãƒ©ãƒ³ãƒ‰å®‰å…¨æ€§ã‚¹ã‚³ã‚¢æ´»ç”¨

### ğŸ“Š ç®¡ç†æ©Ÿèƒ½

- **çµ±è¨ˆãƒ»åˆ†æ**: éå»30æ—¥é–“ã®è¿”ä¿¡çµ±è¨ˆã€å¿œç­”æ™‚é–“åˆ†æ
- **è¨­å®šç®¡ç†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®è¿”ä¿¡ãƒ¢ãƒ¼ãƒ‰ã€ç½²åã€æ¡ä»¶è¨­å®š
- **ãƒ­ã‚°ãƒ»ç›£è¦–**: å®Œå…¨ãªãƒ­ã‚°å‡ºåŠ›ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## æŠ€è¡“æ§‹æˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

1. **EmailAutoReplyService** (`backend/services/email_auto_reply_service.py`)
   - ãƒ¡ã‚¤ãƒ³å‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹
   - Firestoreé€£æº
   - AI agentçµ±åˆ

2. **NegotiationAgentæ‹¡å¼µ** (`backend/services/ai_agents/negotiation_agent.py`)
   - ãƒ¡ãƒ¼ãƒ«è¿”ä¿¡ç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
   - ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿çµ±åˆ
   - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ

3. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ** (`backend/api/email_auto_reply.py`)
   - å®Œå…¨ãªRESTful API
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

4. **ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªçµ±åˆ** (`backend/main.py`)
   - ãƒ«ãƒ¼ã‚¿ãƒ¼ç™»éŒ²æ¸ˆã¿
   - è‡ªå‹•èµ·å‹•è¨­å®š

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

```
email_threads/
â”œâ”€â”€ thread_id (document)
    â”œâ”€â”€ message_id: string
    â”œâ”€â”€ sender_email: string
    â”œâ”€â”€ sender_name: string
    â”œâ”€â”€ original_subject: string
    â”œâ”€â”€ original_body: string
    â”œâ”€â”€ generated_reply: string
    â”œâ”€â”€ status: enum (pending_approval, approved, auto_replied, rejected, expired)
    â”œâ”€â”€ reply_mode: enum (manual_approval, auto_reply)
    â”œâ”€â”€ created_at: timestamp
    â”œâ”€â”€ approval_deadline: timestamp
    â”œâ”€â”€ user_id: string
    â”œâ”€â”€ influencer_data: object
    â””â”€â”€ user_modifications: string

user_reply_settings/
â”œâ”€â”€ user_id (document)
    â”œâ”€â”€ default_mode: enum
    â”œâ”€â”€ approval_timeout_hours: number
    â”œâ”€â”€ custom_signature: string
    â”œâ”€â”€ auto_reply_conditions: object
    â””â”€â”€ updated_at: timestamp
```

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ãƒ¡ãƒ¼ãƒ«å‡¦ç†
- `POST /api/v1/email/process` - å—ä¿¡ãƒ¡ãƒ¼ãƒ«å‡¦ç†
- `POST /api/v1/email/test-reply-generation` - ãƒ†ã‚¹ãƒˆç”¨è¿”ä¿¡ç”Ÿæˆ

### æ‰¿èªç®¡ç†  
- `GET /api/v1/email/pending-replies` - æ‰¿èªå¾…ã¡ä¸€è¦§å–å¾—
- `POST /api/v1/email/approve-reply/{thread_id}` - è¿”ä¿¡æ‰¿èªãƒ»é€ä¿¡
- `POST /api/v1/email/reject-reply/{thread_id}` - è¿”ä¿¡æ‹’å¦

### è¨­å®šç®¡ç†
- `GET /api/v1/email/settings` - è¿”ä¿¡è¨­å®šå–å¾—
- `POST /api/v1/email/settings` - è¿”ä¿¡è¨­å®šæ›´æ–°

### çµ±è¨ˆãƒ»ç›£è¦–
- `GET /api/v1/email/statistics` - è¿”ä¿¡çµ±è¨ˆæƒ…å ±
- `GET /api/v1/email/health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

## ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼

```python
# 1. å—ä¿¡ãƒ¡ãƒ¼ãƒ«å‡¦ç†
email_data = EmailData(
    message_id="msg_001",
    thread_id="thread_001", 
    sender_email="influencer@example.com",
    sender_name="å±±ç”°å¤ªéƒ",
    subject="ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŠå•ã„åˆã‚ã›",
    body="...",
    received_at=datetime.now()
)

result = await email_auto_reply_service.process_incoming_email(
    email_data, 
    user_id="user_001"
)

# 2. æ‰¿èªå¾…ã¡ä¸€è¦§å–å¾—
pending_replies = await email_auto_reply_service.get_pending_replies("user_001")

# 3. è¿”ä¿¡æ‰¿èª
success = await email_auto_reply_service.approve_reply(
    thread_id="thread_001",
    user_modifications="ä¿®æ­£å†…å®¹..."
)
```

## è¨­å®šä¾‹

### æ‰‹å‹•æ‰¿èªãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
```json
{
  "default_mode": "manual_approval",
  "approval_timeout_hours": 24,
  "custom_signature": "ç”°ä¸­ç¾å’²\nInfuMatch ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‹…å½“"
}
```

### è‡ªå‹•è¿”ä¿¡ãƒ¢ãƒ¼ãƒ‰
```json
{
  "default_mode": "auto_reply",
  "auto_reply_conditions": {
    "only_known_influencers": true,
    "minimum_engagement_rate": 2.0,
    "exclude_keywords": ["spam", "åºƒå‘Š", "å®£ä¼"],
    "max_daily_auto_replies": 10
  }
}
```

## ãƒ†ã‚¹ãƒˆ

çµ±åˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `backend/test_email_auto_reply_integration.py`

```bash
cd backend
python3 test_email_auto_reply_integration.py
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆPhase 2 & 3ï¼‰

### Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- [ ] æ‰¿èªå¾…ã¡è¿”ä¿¡ç®¡ç†ãƒšãƒ¼ã‚¸
- [ ] è¿”ä¿¡è¨­å®šç”»é¢
- [ ] çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥

### Phase 3: Gmailçµ±åˆ
- [ ] Gmail Webhooké€£æº
- [ ] å®Ÿéš›ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½
- [ ] ãƒ¡ãƒ¼ãƒ«å±¥æ­´åŒæœŸ
- [ ] AIå­¦ç¿’æ©Ÿèƒ½

## ã¾ã¨ã‚

âœ… **å®Œäº†**: ãƒ¡ãƒ¼ãƒ«è‡ªå‹•è¿”ä¿¡ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤å®Ÿè£…
- AIç”Ÿæˆè¿”ä¿¡æ¡ˆä½œæˆ
- æ‰‹å‹•æ‰¿èªãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- æ¡ä»¶ä»˜ãè‡ªå‹•è¿”ä¿¡ãƒ¢ãƒ¼ãƒ‰é¸æŠ
- å®Œå…¨ãªAPIæä¾›
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

ğŸ¯ **è¦æ±‚é€šã‚Š**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œäººé–“ã®è¨±å¯ã‚’å¾—ã¦ã‹ã‚‰è¿”ä¿¡ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã¨é¸æŠã§ãã‚‹ã€ã¨ã„ã†è¦æ±‚ã‚’å®Œå…¨ã«æº€ãŸã—ã¦ã„ã¾ã™ã€‚

ğŸš€ **æº–å‚™å®Œäº†**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã¨Gmail APIçµ±åˆã®ãŸã‚ã®åŸºç›¤ãŒæ•´ã„ã¾ã—ãŸã€‚